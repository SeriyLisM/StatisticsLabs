import math
from scipy.stats import norm # Для функции Лапласа

def load_data_from_file(filename):
    """Загружает данные из файла."""
    data = []
    try:
        with open(filename, 'r') as f:
            for line in f:
                line = line.strip()
                if line:  
                    data.append(float(line))
        if len(data) == 0:
            print("Файл пуст.")
            return None
        return data
    except FileNotFoundError:
        print(f"Файл {filename} не найден.")
        return None
    except ValueError:
        print("Ошибка при чтении данных из файла. Убедитесь, что файл содержит только числа.")
        return None

filename = input("Введите имя файла с данными (например, data.txt): ")
data = load_data_from_file(filename)

if data is None:
    exit()

n = len(data)
print(f"Загружено {n} значений.")

# Расчет выборочной средней и стандартного отклонения
x_mean = sum(data) / n
s_squared = sum((x - x_mean)**2 for x in data) / (n - 1)
s = math.sqrt(s_squared)

print(f"\nОценка математического ожидания (μ): {x_mean:.6f}")
print(f"Оценка среднеквадратичного отклонения (σ): {s:.6f}")

xmin = min(data)
xmax = max(data)
R = xmax - xmin

# Формула Стерджесса
k = int(round(1 + 3.22 * math.log10(n)))
if k < 1:
    k = 1
Delta_x = R / k

intervals = []
current_min = xmin
for i in range(k):
    current_max = current_min + Delta_x if i < k - 1 else xmax
    intervals.append((current_min, current_max))
    current_min = current_max

probabilities = []

for i, (left_bound, right_bound) in enumerate(intervals):
    # z-оценки для границ интервала
    z_left = (left_bound - x_mean) / s
    z_right = (right_bound - x_mean) / s
    
    # F(x) = Φ(z)
    prob_left = norm.cdf(z_left)   
    prob_right = norm.cdf(z_right) 
    
    # P_i = F(x^i) - F(x^(i-1)) = Φ(z_right) - Φ(z_left)
    P_i = prob_right - prob_left
    probabilities.append(P_i)

print("\n" + "="*80)
print("ТЕОРЕТИЧЕСКИЕ ЧАСТОТЫ ПОПАДАНИЯ СЛУЧАЙНОЙ ВЕЛИЧИНЫ В ИНТЕРВАЛЫ")
print("="*80)
print(f"{'Интервал':<25} {'Теоретическая вероятность P_i':<30}")
print("-" * 80)
for i, (left_bound, right_bound) in enumerate(intervals):
    interval_str = f"[{left_bound:.2f}; {right_bound:.2f})"
    if i == k - 1:
        interval_str = f"[{left_bound:.2f}; {right_bound:.2f}]"
    print(f"{interval_str:<25} {probabilities[i]:<30.6f}")
print("-" * 80)

output_filename = "theor_probab.txt"
with open(output_filename, "w") as f:
    f.write("Границы интервалов\tТеоретическая вероятность P_i\n")
    for i, (left_bound, right_bound) in enumerate(intervals):
        interval_str = f"[{left_bound:.2f}; {right_bound:.2f})"
        if i == k - 1:
            interval_str = f"[{left_bound:.2f}; {right_bound:.2f}]"
        f.write(f"{interval_str}\t{probabilities[i]:.6f}\n")

print(f"\nРезультаты сохранены в файл {output_filename}.")
